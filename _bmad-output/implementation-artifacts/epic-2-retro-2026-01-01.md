# Retrospectiva - Épica 2: Catálogos base (Categorías, Marcas, Ubicaciones) + Soft-delete/Restauración

- Proyecto: GATIC
- Fecha: 2026-01-01
- Epic: 2
- Fuente de tracking: `_bmad-output/implementation-artifacts/sprint-status.yaml`
- Evidencia principal: stories `_bmad-output/implementation-artifacts/2-*.md`

## Participantes

- Carlos (Project Lead)
- Bob (Scrum Master)
- Alice (Product Owner)
- Charlie (Senior Dev)
- Dana (QA Engineer)
- Elena (Junior Dev)
- Winston (Architect)

## Resumen de la Épica

La Épica 2 entregó el módulo base de **Catálogos** con enfoque en integridad y operación diaria:

- Gestión de **Categorías** con reglas funcionales (`is_serialized`, `requires_asset_tag`) y validación de consistencia.
- Gestión de **Marcas** y **Ubicaciones** con CRUD Livewire + Bootstrap, búsqueda por nombre y soft-delete.
- **Soft-delete y restauración** (Papelera) para catálogos, con restauración **solo Admin** y bloqueo por “en uso” (FR7) con verificación server-side reutilizable.

### Métricas (según sprint-status)

- Historias completadas: 4/4 (100%)
- Story points / sprints: N/D en artefactos

### Historias entregadas

- 2.1 Gestionar Categorías (incluye serializado/asset_tag)
- 2.2 Gestionar Marcas
- 2.3 Gestionar Ubicaciones
- 2.4 Soft-delete y restauración de catálogos

## Lo que salió bien (fortalezas)

### 1) Guardrails consistentes (RBAC + defensa en profundidad)

- Se aplicó el gate `catalogs.manage` (Admin/Editor) de forma consistente: middleware `can:` + `Gate::authorize()` dentro de acciones Livewire.
- Se agregaron y reforzaron **tests** para evitar “agujeros” (por ejemplo, intentos de ejecutar acciones Livewire sin permisos).

### 2) Reglas de datos claras y repetibles (normalización + unicidad real)

- Contrato repetido y validado en catálogos: `trim` + colapsar espacios + **unicidad case/acento-insensible** con collation MySQL 8 (`utf8mb4_0900_ai_ci`) e índice único.
- Unicidad incluyendo eliminados: se evitó el antipatrón de “re-crear” registros; se favorece restaurar/renombrar.

### 3) Calidad apoyada por code review “adversarial”

- Los reviews detectaron huecos reales (p. ej. navegación faltante, escape de `LIKE`, gaps de tests) y quedaron corregidos y documentados.
- Se mejoró la resiliencia ante condiciones típicas: colisiones de unicidad (DB unique) y mensajes de error claros en UI.

### 4) UX coherente (sin inventar patrones nuevos)

- Reuso de toasts, confirmaciones y patrones de “operación lenta” (cancelar) para acciones sensibles (guardar/eliminar/restaurar).
- “Papelera de catálogos” como fuente de verdad para restauración (admin-only).

## Desafíos (áreas de mejora)

### 1) Descubrimiento de épicas para workflows (señal de fricción de proceso)

- El workflow de retrospectiva intentó localizar documentos de épicas en `_bmad-output/*epic*.md`, pero los épicos reales viven en rutas anidadas (p. ej. `_bmad-output/project-planning-artifacts/epics.md` y `_bmad-output/implementation-artifacts/epics-github.md`).
- Impacto: el “preview del siguiente epic” quedó degradado y depende de caminos manuales.

### 2) Repetición de fixes de “higiene” en varios módulos

- Escape de comodines `LIKE` (`%`, `_`) y manejo de colisiones de unicidad se corrigieron en más de un componente.
- Oportunidad: consolidar helpers/servicios para reducir drift y asegurar consistencia transversal.

## Patrones y lecciones (sintetizado desde Stories 2.1–2.4)

### Patrones recurrentes (buenos)

- **Defensa en profundidad** como default (rutas + Livewire).
- **Reglas de datos** (normalización + unicidad incluyendo soft-deleted) como contrato de dominio.
- **Tests de feature** como herramienta de cierre, no como “extra”.

### Aprendizajes clave

1) La integridad “se gana” con reglas repetibles y verificables: collation + índice único + normalización, no solo validaciones de UI.
2) Para Livewire, el “server-side auth” debe ser parte del diseño: los tests de acciones Livewire evitan regresiones silenciosas.
3) La “Papelera” es un patrón de producto y de seguridad: hace reversible el error operativo sin forzar borrados físicos.

## Seguimiento de retrospectiva anterior (Épica 1)

Se revisaron compromisos de la retrospectiva de Épica 1 (`_bmad-output/implementation-artifacts/epic-1-retro-2025-12-30.md`):

- Política de merges manual (PR + CI verde verificado): **aparenta estar en práctica** (evidencia: ejecución de tests y fixes por reviews).
- Checklist de cierre de story (tests + Pint + evidencia en artefacto): **cumplido en esta épica** (cada story incluye verificación y/o review).
- Normalizar ubicación del documento de épicas para workflows: **pendiente** (se manifestó en este retrospective).

## Preparación para la próxima épica (según sprint-status)

Aunque el documento “Epic 3” no fue localizado por el workflow, `sprint-status.yaml` muestra **Épica 3** en backlog (Productos/Activos/Inventario). Dependencias claras desde Épica 2:

- Catálogos y reglas de unicidad ya establecidos (base para Productos y Activos).
- Soft-delete + restauración (administración y operación) listos para reuso.

Riesgos a anticipar para Épica 3:

- Reglas de unicidad (serial por producto, `asset_tag` global) y validaciones transaccionales.
- “En uso”/integridad: ampliar `CatalogUsage` cuando existan tablas de inventario y relaciones reales.

### Tareas de preparación propuestas (Épica 3) — sin estimaciones

- [ ] Alinear y documentar reglas de unicidad y validación para Activos serializados (serial por producto, `asset_tag` global)  
  Owner: Winston (Architect) + Charlie (Senior Dev)
- [ ] Definir seeds mínimos operativos para catálogos y escenarios de prueba (incluye casos con acentos/espacios)  
  Owner: Dana (QA Engineer) + Elena (Junior Dev)
- [ ] Preparar checklist de “catálogo referenciado / en uso” para nuevas tablas de inventario (qué bloquea y cómo se comunica)  
  Owner: Winston (Architect)

## Action Items (compromisos) — sin estimaciones

### Proceso

1) **Normalizar el “Epic source of truth” para workflows**
   - Owner: Bob (Scrum Master) + Paige (Technical Writer)
   - Deadline: Antes de correr el siguiente workflow de retrospectiva / sprint-planning
   - Criterio de éxito: el workflow encuentra el epic actual/siguiente sin depender de rutas manuales

2) **Checklist estándar de “defensa en profundidad Livewire”**
   - Owner: Charlie (Senior Dev) + Dana (QA Engineer)
   - Deadline: Antes de iniciar desarrollo de Épica 3
   - Criterio de éxito: toda acción Livewire sensible exige `authorize()` y tiene test de rol (incluye llamada directa al componente)

### Técnico

3) **Consolidar helpers de búsqueda y normalización**
   - Owner: Winston (Architect) + Charlie (Senior Dev)
   - Deadline: Antes de expandir CRUDs de inventario en Épica 3
   - Criterio de éxito: un único helper/servicio para (a) normalización de `name` y (b) escape seguro de `LIKE`, usado por todos los módulos relevantes

4) **Estrategia de integridad “en uso” para el crecimiento del dominio**
   - Owner: Winston (Architect)
   - Deadline: Antes de la primera historia de inventario que introduzca referencias reales a catálogos
   - Criterio de éxito: `CatalogUsage` cubre las nuevas relaciones y se valida con tests

### Producto / Operación

5) **Definir y registrar aceptación (PO) por épica**
   - Owner: Alice (Product Owner) + Carlos (Project Lead)
   - Deadline: Antes de marcar la próxima épica como `done`
   - Criterio de éxito: existe evidencia de demo/revisión y un “sign-off” simple en artefactos

## Ruta crítica (antes de iniciar Épica 3) — sin estimaciones

1) Epic discovery para workflows (Action Item #1) resuelto
2) Checklist Livewire “defensa en profundidad” aplicado en el arranque de Épica 3 (Action Item #2)
3) Aceptación/validación de la Épica 2 trazada (Action Item #5)

## Readiness Assessment (Épica 2)

- Testing & Quality: hay evidencia en stories (tests de feature + ejecución de suite) y artefactos `validation-report-*.md`.
- Deployment: no trazado en artefactos (acción: capturar estado de despliegue como parte del cierre).
- Aceptación de stakeholders: no trazada (acción: agregar sign-off simple).
- Salud técnica: base consistente; los fixes repetidos sugieren oportunidad de consolidación transversal.

## Cierre

La Épica 2 deja una base sólida de Catálogos con reglas de integridad y operación (Papelera + bloqueo por “en uso”). El principal ajuste a corto plazo es **cerrar la brecha de proceso** (descubrimiento de épicas para workflows) y consolidar patrones repetidos para acelerar Épica 3 sin drift.
