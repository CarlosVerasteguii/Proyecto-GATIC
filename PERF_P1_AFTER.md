# PERF P1 After (After Changes) — 2026-01-31

Scope: **Fase 2 = P1**. Este archivo contiene **MEDICIÓN DESPUÉS** + confirmaciones (EXPLAIN) usando el estado actual **post-P1**.

## 1) Setup (repro)

```powershell
docker compose -f gatic/compose.yaml up -d
docker compose -f gatic/compose.yaml exec -T laravel.test php artisan migrate:fresh --seed
```

App: `http://localhost:8080` (APP_PORT=8080).

Usuarios seeded:
- Admin: `admin@gatic.local` / `password`
- Lector: `lector@gatic.local` / `password`

## 2) Metodología

Misma que baseline (`PERF_P1_BASELINE.md`):
- `curl.exe` (`time_starttransfer` = TTFB, `time_total` = total)
- `p50/p90` = nearest-rank (n=10)
- Livewire: POST real a `/livewire/update` con `wire:snapshot` + `data-csrf`

## 3) Resultados — HTTP (cURL)

### /inventory/search?q=Dell (Admin; n=10)
- TTFB p50/p90: **459ms / 2072ms**
- Total p50/p90: **460ms / 2078ms**

### /inventory/products (Admin vs Lector; interleaved; n=10 por rol)

Admin:
- TTFB p50/p90: **376ms / 445ms**
- Total p50/p90: **378ms / 446ms**

Lector:
- TTFB p50/p90: **379ms / 2068ms**
- Total p50/p90: **380ms / 2074ms**

## 4) Resultados — Livewire

### InventorySearch — `submitSearch` con `search=Dell` (n=10)
- TTFB p50/p90: **379ms / 2070ms**
- Total p50/p90: **380ms / 2079ms**

### PendingTaskShow — “Procesar” (2 requests; n=10)
- `enterProcessMode` Total p50/p90: **411ms / 2133ms**
- `initProcessModeUi` Total p50/p90: **1958ms / 2154ms**
- `enter + init` Total p50/p90: **2376ms / 2568ms**

## 5) DB — EXPLAIN ANALYZE (MySQL 8.x local)

### 5.1 Búsqueda por nombre (FULLTEXT) — `match(name) against('+Dell*' in boolean mode)`

```sql
EXPLAIN ANALYZE
select * from products
where match(name) against ('+Dell*' in boolean mode)
  and products.deleted_at is null
order by products.name asc
limit 20;
```

Output:

```text
*************************** 1. row ***************************
EXPLAIN: -> Limit: 20 row(s)  (cost=0.35 rows=1) (actual time=0.0318..0.0319 rows=1 loops=1)
    -> Sort row IDs: products.`name`, limit input to 20 row(s) per chunk  (cost=0.35 rows=1) (actual time=0.0311..0.0311 rows=1 loops=1)
        -> Filter: ((match products.`name` against ('+Dell*' in boolean mode)) and (products.deleted_at is null))  (cost=0.35 rows=1) (actual time=0.0163..0.017 rows=1 loops=1)
            -> Full-text index search on products using products_name_fulltext (name='+Dell*')  (cost=0.35 rows=1) (actual time=0.0142..0.0148 rows=1 loops=1)
```

Ejemplo clave de “robustez” (antes NO matcheaba por prefijo):

```sql
EXPLAIN ANALYZE
select * from products
where match(name) against ('+Latitude*' in boolean mode)
  and products.deleted_at is null
order by products.name asc
limit 20;
```

Output:

```text
*************************** 1. row ***************************
EXPLAIN: -> Limit: 20 row(s)  (cost=0.35 rows=1) (actual time=0.0974..0.0975 rows=1 loops=1)
    -> Sort row IDs: products.`name`, limit input to 20 row(s) per chunk  (cost=0.35 rows=1) (actual time=0.0964..0.0965 rows=1 loops=1)
        -> Filter: ((match products.`name` against ('+Latitude*' in boolean mode)) and (products.deleted_at is null))  (cost=0.35 rows=1) (actual time=0.0476..0.0484 rows=1 loops=1)
            -> Full-text index search on products using products_name_fulltext (name='+Latitude*')  (cost=0.35 rows=1) (actual time=0.0415..0.0422 rows=1 loops=1)
```

### 5.2 assets serial/tag LIKE "Dell%" (se mantiene range scan)

```text
*************************** 1. row ***************************
EXPLAIN: -> Limit: 20 row(s)  (cost=1.61 rows=2) (actual time=0.0376..0.0376 rows=0 loops=1)
    -> Sort: assets.`serial`, limit input to 20 row(s) per chunk  (cost=1.61 rows=2) (actual time=0.0371..0.0371 rows=0 loops=1)
        -> Filter: (((assets.`serial` like 'Dell%') or (assets.asset_tag like 'Dell%')) and (assets.deleted_at is null))  (cost=1.61 rows=2) (actual time=0.0327..0.0327 rows=0 loops=1)
            -> Sort-deduplicate by row ID  (cost=1.61 rows=2) (actual time=0.0322..0.0322 rows=0 loops=1)
                -> Index range scan on assets using assets_serial_index over ('Dell' <= serial <= 'Dell????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????')  (cost=0.36 rows=1) (actual time=0.0145..0.0145 rows=0 loops=1)
                -> Index range scan on assets using assets_asset_tag_unique over ('Dell' <= asset_tag <= 'Dell????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????')  (cost=0.36 rows=1) (actual time=0.00295..0.00295 rows=0 loops=1)
```

### 5.3 assets.serial exact (se mantiene index lookup)

```text
*************************** 1. row ***************************
EXPLAIN: -> Filter: (assets.deleted_at is null)  (cost=0.27 rows=0.2) (actual time=0.0373..0.0393 rows=1 loops=1)
    -> Index lookup on assets using assets_serial_index (serial='SN-DEMO-001')  (cost=0.27 rows=1) (actual time=0.0365..0.0384 rows=1 loops=1)
```

### 5.4 /inventory/products (agregados + join; sin subqueries dependientes)

```text
*************************** 1. row ***************************
EXPLAIN: -> Limit: 16 row(s)  (cost=1.3 rows=1) (actual time=0.233..0.234 rows=1 loops=1)
    -> Nested loop left join  (cost=1.3 rows=1) (actual time=0.232..0.233 rows=1 loops=1)
        -> Nested loop left join  (cost=0.7 rows=1) (actual time=0.0786..0.0792 rows=1 loops=1)
            -> Sort: products.`name`  (cost=0.35 rows=1) (actual time=0.0611..0.0613 rows=1 loops=1)
                -> Filter: (products.deleted_at is null)  (cost=0.35 rows=1) (actual time=0.0439..0.0478 rows=1 loops=1)
                    -> Table scan on products  (cost=0.35 rows=1) (actual time=0.0423..0.046 rows=1 loops=1)
            -> Filter: (categories_for_counts.deleted_at is null)  (cost=0.35 rows=1) (actual time=0.0168..0.017 rows=1 loops=1)
                -> Single-row index lookup on categories_for_counts using PRIMARY (id=products.category_id)  (cost=0.35 rows=1) (actual time=0.0164..0.0165 rows=1 loops=1)
        -> Index lookup on asset_counts using <auto_key0> (product_id=products.id)  (cost=1.3..1.65 rows=2) (actual time=0.15..0.151 rows=1 loops=1)
            -> Materialize  (cost=0.95..0.95 rows=1) (actual time=0.145..0.145 rows=1 loops=1)
                -> Group aggregate: sum((case when (assets.`status` <> 'Retirado') then 1 else 0 end)), sum((case when (assets.`status` in ('Asignado','Prestado','Pendiente de Retiro')) then 1 else 0 end))  (cost=0.85 rows=1) (actual time=0.0419..0.0419 rows=1 loops=1)
                    -> Filter: (assets.deleted_at is null)  (cost=0.75 rows=1) (actual time=0.0181..0.0237 rows=5 loops=1)
                        -> Covering index scan on assets using assets_product_id_status_deleted_at_index  (cost=0.75 rows=5) (actual time=0.0177..0.023 rows=5 loops=1)
```

