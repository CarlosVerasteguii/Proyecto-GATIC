# PERF P1 Baseline (Before) — 2026-01-31

Scope: **Fase 2 = P1**. Este archivo contiene **solo baseline (MEDIR ANTES)** usando el estado actual **post-P0**.

## 1) Setup (repro)

```powershell
docker compose -f gatic/compose.yaml up -d
docker compose -f gatic/compose.yaml exec -T laravel.test php artisan migrate:fresh --seed
```

App: `http://localhost:8080` (APP_PORT=8080).

Usuarios seeded:
- Admin: `admin@gatic.local` / `password`
- Lector: `lector@gatic.local` / `password`

Dataset demo (después de seed):
- products: 1
- assets: 5
- pending_tasks: 1

## 2) Metodología (Measure → Analyze)

### Percentiles
- `p50/p90`: **nearest-rank** (n=10; p90 = 9º valor ordenado cuando n=10).
- Unidades: ms (convertido desde segundos de `curl`).

### HTTP (cURL)
- `TTFB` = `time_starttransfer`
- `Total` = `time_total`
- 1 warmup por endpoint (no contado) + n=10.

### Livewire (medición real `/livewire/update`)
- Se extrae `wire:snapshot` + `data-csrf` desde el HTML, y se POSTea a `/livewire/update`.
- `InventorySearch`: 1 request por búsqueda via `submitSearch` con `search=Dell`.
- `PendingTaskShow`: interacción “Procesar” = `enterProcessMode` + `initProcessModeUi` (2 requests).
  - Para dejar el sistema listo para la siguiente repetición se llama `exitProcessMode` (no incluido en las métricas).

## 3) Resultados — HTTP (cURL)

### /inventory/search?q=Dell (Admin; n=10)
- TTFB p50/p90: **385ms / 2061ms**
- Total p50/p90: **386ms / 2070ms**

### /inventory/products (Admin vs Lector; interleaved; n=10 por rol)

Admin:
- TTFB p50/p90: **441ms / 2214ms**
- Total p50/p90: **443ms / 2231ms**

Lector:
- TTFB p50/p90: **350ms / 2576ms**
- Total p50/p90: **351ms / 2585ms**

## 4) Resultados — Livewire

### InventorySearch — `submitSearch` con `search=Dell` (n=10)
- TTFB p50/p90: **308ms / 2212ms**
- Total p50/p90: **309ms / 2218ms**

### PendingTaskShow — “Procesar” (2 requests; n=10)
- `enterProcessMode` Total p50/p90: **347ms / 2015ms**
- `initProcessModeUi` Total p50/p90: **253ms / 2230ms**
- `enter + init` Total p50/p90: **2124ms / 2935ms**

## 5) DB — EXPLAIN ANALYZE (MySQL 8.x local)

### 5.1 products.name LIKE "Dell%" (post-P0: prefijo index-friendly)

```sql
EXPLAIN ANALYZE
select * from products
where name like 'Dell%' and products.deleted_at is null
order by name asc
limit 20;
```

Output:

```text
*************************** 1. row ***************************
EXPLAIN: -> Limit: 20 row(s)  (cost=0.71 rows=1) (actual time=0.0146..0.0146 rows=0 loops=1)
    -> Filter: (products.deleted_at is null)  (cost=0.71 rows=1) (actual time=0.0142..0.0142 rows=0 loops=1)
        -> Index range scan on products using products_name_index over ('Dell' <= name <= 'Dell????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????'), with index condition: (products.`name` like 'Dell%')  (cost=0.71 rows=1) (actual time=0.0136..0.0136 rows=0 loops=1)
```

### 5.2 assets serial/tag LIKE "Dell%" (post-P0: range scan)

```sql
EXPLAIN ANALYZE
select * from assets
where (serial like 'Dell%' or asset_tag like 'Dell%')
  and assets.deleted_at is null
order by serial asc
limit 20;
```

Output:

```text
*************************** 1. row ***************************
EXPLAIN: -> Limit: 20 row(s)  (cost=1.61 rows=2) (actual time=0.0599..0.0599 rows=0 loops=1)
    -> Sort: assets.`serial`, limit input to 20 row(s) per chunk  (cost=1.61 rows=2) (actual time=0.0592..0.0592 rows=0 loops=1)
        -> Filter: (((assets.`serial` like 'Dell%') or (assets.asset_tag like 'Dell%')) and (assets.deleted_at is null))  (cost=1.61 rows=2) (actual time=0.0548..0.0548 rows=0 loops=1)
            -> Sort-deduplicate by row ID  (cost=1.61 rows=2) (actual time=0.0543..0.0543 rows=0 loops=1)
                -> Index range scan on assets using assets_serial_index over ('Dell' <= serial <= 'Dell????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????')  (cost=0.36 rows=1) (actual time=0.0254..0.0254 rows=0 loops=1)
                -> Index range scan on assets using assets_asset_tag_unique over ('Dell' <= asset_tag <= 'Dell????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????')  (cost=0.36 rows=1) (actual time=0.00356..0.00356 rows=0 loops=1)
```

### 5.3 assets.serial exact (post-P0: index lookup)

```sql
EXPLAIN ANALYZE
select * from assets
where serial = 'SN-DEMO-001' and assets.deleted_at is null
order by serial asc;
```

Output:

```text
*************************** 1. row ***************************
EXPLAIN: -> Filter: (assets.deleted_at is null)  (cost=0.27 rows=0.2) (actual time=0.0179..0.0199 rows=1 loops=1)
    -> Index lookup on assets using assets_serial_index (serial='SN-DEMO-001')  (cost=0.27 rows=1) (actual time=0.0171..0.019 rows=1 loops=1)
```

### 5.4 /inventory/products (post-P0: subqueries correlacionadas siguen presentes)

```sql
EXPLAIN ANALYZE
select products.*,
  categories_for_counts.is_serialized as category_is_serialized,
  (select count(*)
   from assets
   where assets.product_id = products.id
     and assets.status != 'Retirado'
     and categories_for_counts.is_serialized = 1
     and assets.deleted_at is null) as assets_total,
  (select count(*)
   from assets
   where assets.product_id = products.id
     and assets.status in ('Asignado','Prestado','Pendiente de Retiro')
     and categories_for_counts.is_serialized = 1
     and assets.deleted_at is null) as assets_unavailable
from products
left join categories as categories_for_counts
  on categories_for_counts.id = products.category_id
 and categories_for_counts.deleted_at is null
where products.deleted_at is null
order by products.name asc
limit 16 offset 0;
```

Output:

```text
*************************** 1. row ***************************
EXPLAIN: -> Limit: 16 row(s)  (cost=0.7 rows=1) (actual time=0.0478..0.0483 rows=1 loops=1)
    -> Nested loop left join  (cost=0.7 rows=1) (actual time=0.0469..0.0473 rows=1 loops=1)
        -> Sort: products.`name`  (cost=0.35 rows=1) (actual time=0.0373..0.0373 rows=1 loops=1)
            -> Filter: (products.deleted_at is null)  (cost=0.35 rows=1) (actual time=0.0234..0.0268 rows=1 loops=1)
                -> Table scan on products  (cost=0.35 rows=1) (actual time=0.0222..0.0256 rows=1 loops=1)
        -> Filter: (categories_for_counts.deleted_at is null)  (cost=0.35 rows=1) (actual time=0.00899..0.00912 rows=1 loops=1)
            -> Single-row index lookup on categories_for_counts using PRIMARY (id=products.category_id)  (cost=0.35 rows=1) (actual time=0.0086..0.00866 rows=1 loops=1)
-> Select #2 (subquery in projection; dependent)
    -> Aggregate: count(0)  (cost=0.85 rows=1) (actual time=0.0231..0.0232 rows=1 loops=1)
        -> Filter: ((assets.product_id = products.id) and (assets.`status` <> 'Retirado') and (categories_for_counts.is_serialized = 1) and (assets.deleted_at is null))  (cost=0.75 rows=1) (actual time=0.017..0.0206 rows=4 loops=1)
            -> Table scan on assets  (cost=0.75 rows=5) (actual time=0.0151..0.0176 rows=5 loops=1)
-> Select #3 (subquery in projection; dependent)
    -> Aggregate: count(0)  (cost=0.85 rows=1) (actual time=0.00756..0.00757 rows=1 loops=1)
        -> Filter: ((assets.product_id = products.id) and (assets.`status` in ('Asignado','Prestado','Pendiente de Retiro')) and (categories_for_counts.is_serialized = 1) and (assets.deleted_at is null))  (cost=0.75 rows=1) (actual time=0.00477..0.00711 rows=3 loops=1)
            -> Table scan on assets  (cost=0.75 rows=5) (actual time=0.00361..0.00494 rows=5 loops=1)
```

