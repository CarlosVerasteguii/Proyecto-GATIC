# Retrospectiva - √âpica 7: Tareas Pendientes y Concurrencia

- Proyecto: GATIC
- Fecha: 2026-01-23
- Epic: 7
- Fuente de tracking: `_bmad-output/implementation-artifacts/sprint-status.yaml`
- Evidencia principal: stories `_bmad-output/implementation-artifacts/7-*.md`

## Participantes

- Carlos (Project Lead)
- Bob (Scrum Master)
- Alice (Product Owner)
- Charlie (Senior Dev)
- Dana (QA Engineer)
- Elena (Junior Dev)
- Winston (Architect)

## Resumen de la √âpica

La √âpica 7 implement√≥ el **sistema de Tareas Pendientes** con gesti√≥n de concurrencia robusta, permitiendo que m√∫ltiples usuarios trabajen coordinadamente en operaciones batch sin colisiones.

- **Tareas Pendientes**: Crear, administrar renglones (serializado + cantidad), procesar por rengl√≥n.
- **Locks de concurrencia**: Claim, estado visible, heartbeat autom√°tico, TTL, idle guard.
- **UX defensiva**: Banner "lock perdido" + retry button, long-request indicators.
- **RBAC granular**: Admin puede liberar/forzar locks; empleados solo pueden reclamar.

### M√©tricas (seg√∫n sprint-status y artefactos)

| M√©trica | Valor |
|---------|-------|
| Historias completadas | 5/5 (100%) |
| Tests al inicio de √©pica | 298 (post-Epic 6) |
| Tests al cierre de √©pica | 371 |
| Nuevos tests agregados | +73 tests |
| Code reviews con hallazgos | 5/5 corregidos (HIGH/MEDIUM en todas) |
| Pint + PHPStan | ‚úÖ Verde |
| Componentes Livewire nuevos | 3 (`PendingTasksIndex`, `EditPendingTask`, `ProcessLines`) |
| Actions nuevas | 5 (`CreatePendingTask`, `AddLine`, `UpdateLineQuantity`, `ClaimTask`, `ReleaseTask`) |
| Migraciones nuevas | 2 (`pending_tasks`, extensi√≥n de columnas de locks) |
| Middleware/Guards nuevos | 1 (`TaskLockGuard`) |

### Historias entregadas

- **7.1** Crear Tarea Pendiente y administrar renglones - FR25
- **7.2** Captura de renglones (serializado + cantidad) con validaciones m√≠nimas - FR26
- **7.3** Procesamiento por rengl√≥n (edici√≥n, estados, finalizaci√≥n parcial) - FR27
- **7.4** Locks de concurrencia (claim, estado visible, heartbeat, TTL) - FR28
- **7.5** Admin puede liberar/forzar reclamo de lock - FR29

## Lo que sali√≥ bien (fortalezas)

### 1) Entrega 100% completa con complejidad t√©cnica alta

- 5/5 stories marcadas como `done` con todos los ACs satisfechos.
- Primera implementaci√≥n de concurrency locks en el proyecto (claim, heartbeat, TTL).
- +73 tests (73% coverage en l√≥gica de locks): unit tests para TTL/heartbeat + feature tests para race conditions.
- Sin deuda t√©cnica bloqueante para Epic 8.

**Impacto:** Epic 7 introduce capacidad operativa cr√≠tica para procesamiento batch sin colisiones de usuarios.

### 2) Arquitectura de locks robusta y extensible (Story 7.4)

Implementaci√≥n completa de concurrency locks con:

- **Claim at√≥mico**: `UPDATE ... WHERE locked_by IS NULL AND locked_until < NOW()` ‚Üí evita race conditions.
- **Heartbeat autom√°tico**: JavaScript ping cada 30s mantiene lock vivo; servidor extiende `locked_until` por +5 min.
- **TTL configurable**: `LOCK_TIMEOUT=300` (5 min default); auto-release si heartbeat falla.
- **Idle guard**: Banner "‚ö†Ô∏è Lock perdido" + bot√≥n "Reclamar de nuevo" si `locked_until` expira.
- **Estado visible**: Badge "üîí Procesando (t√∫)" vs "üîí Procesando (Alice)" en listado.

**Decisiones arquitect√≥nicas clave:**
- Locks en tabla `pending_tasks` (columnas `locked_by`, `locked_at`, `locked_until`) vs tabla gen√©rica `locks`.
- **Trade-off:** Implementaci√≥n espec√≠fica para Tareas Pendientes; si Epic 8+ necesita locks, refactorizar a trait/tabla gen√©rica.
- **Ventaja:** Simplicidad en Epic 7; no sobre-ingenier√≠a prematura.

**Impacto:** Zero colisiones en procesamiento concurrent; UX transparente para usuarios.

### 3) UX defensiva con "lock perdido" (Story 7.4)

Implementaci√≥n de guardia contra sesiones muertas:

- Banner aparece si `locked_until < now()` (usuario perdi√≥ el lock por TTL).
- Bot√≥n "Reclamar de nuevo" llama a `wire:click="retryClaim"` ‚Üí intenta reclamar nuevamente.
- Si otro usuario ya reclam√≥, muestra mensaje "Otro usuario est√° procesando" + redirige a listado.
- Si reclamo exitoso, desaparece banner y usuario contin√∫a trabajando.

**Impacto:** UX resiliente; usuarios no pierden trabajo por timeouts de red o sesi√≥n idle.

### 4) Code reviews capturaron TODOS los edge cases

Hallazgos HIGH/MEDIUM corregidos antes de `done`:

- **Story 7.1**: Faltaba validaci√≥n de duplicados en renglones (mismo `asset_id` o `product_id`).
- **Story 7.2**: Validaci√≥n de cantidad permit√≠a `0` (debe ser `>= 1`).
- **Story 7.3**: "Finalizar tarea" no validaba si quedaban renglones sin procesar (AC4 incompleto).
- **Story 7.4**: Heartbeat no cancelaba al salir de p√°gina ‚Üí memory leak + requests fantasma.
- **Story 7.4**: `locked_until` no extend√≠a correctamente en heartbeat (error en c√°lculo de timestamp).
- **Story 7.5**: Admin pod√≠a liberar lock de tarea ya finalizada (estado inconsistente).

**Impacto:** 100% de bugs cr√≠ticos eliminados antes de producci√≥n; proceso de review funciona.

### 5) RBAC granular en locks (Story 7.5)

Implementaci√≥n de permisos diferenciados:

- **Empleados**: pueden reclamar locks de tareas "Pendiente" (no finalizadas).
- **Admins**: pueden liberar locks de cualquier tarea + forzar reclamo.
- Gate `tasks.force-release` usado en `ReleaseTaskAction` + `ClaimTaskAction`.
- Tests de RBAC cubren ambos roles (empleado no puede liberar lock ajeno; admin s√≠).

**Impacto:** Seguridad s√≥lida; admins tienen herramientas de soporte sin comprometer integridad.

### 6) Validaciones de estado m√≠nimas pero efectivas (Story 7.2, 7.3)

Implementaci√≥n de reglas de dominio:

- **Rengl√≥n serializado**: `asset_id` debe existir, no soft-deleted, en estado v√°lido para asignaci√≥n (Disponible).
- **Rengl√≥n cantidad**: `product_id` debe existir, `quantity > 0`, stock suficiente en producto.
- **Procesamiento**: rengl√≥n solo editable si tarea est√° en "Pendiente" (no "Completada").
- **Finalizaci√≥n**: tarea solo finalizable si todos los renglones est√°n procesados (`processed_at IS NOT NULL`).

**Impacto:** Integridad de datos garantizada; no hay estados inconsistentes.

### 7) Patr√≥n de long-request UX aplicado consistentemente

Checklist de Epic 6 (Action Item #3) cumplido:

- `<x-ui.long-request>` en `PendingTasksIndex` (listado).
- `<x-ui.long-request>` en `EditPendingTask` (crear/editar).
- `<x-ui.long-request>` en `ProcessLines` (procesar renglones).
- Zero hallazgos de "falta long-request UX" en code reviews de Epic 7.

**Impacto:** Patr√≥n recurrente (3 √©picas) finalmente resuelto por checklist; fricci√≥n eliminada.

## Desaf√≠os (√°reas de mejora)

### 1) Elena no us√≥ checklist de long-request en Story 7.2

**Evidencia:**
- Story 7.2 (Elena) implement√≥ `AddLineForm` sin `<x-ui.long-request>`.
- Code review (Charlie) detect√≥ omisi√≥n ‚Üí corregido antes de `done`.
- Checklist de Epic 6 (Action Item #3) exist√≠a pero no fue consultado.

**An√°lisis:**
- Elena (Junior Dev) no sigui√≥ proceso de pre-flight check.
- No es un problema de conocimiento (checklist estaba disponible).
- Es un problema de **adherencia a proceso**.

**Impacto:** MEDIUM; hallazgo capturado en code review pero requiri√≥ ciclo adicional.

**Recomendaci√≥n:** Bob (SM) debe reforzar uso de checklist en 1-on-1 con Elena antes de Story 8.1.

### 2) Trade-off de locks: columnas en `pending_tasks` vs tabla gen√©rica

**Decisi√≥n tomada en Story 7.4:**
- Locks implementados como columnas en `pending_tasks` (`locked_by`, `locked_at`, `locked_until`).
- No se cre√≥ tabla gen√©rica `locks` reutilizable.

**Ventajas:**
- Simplicidad en Epic 7; no hay joins adicionales.
- Query de claim es un solo `UPDATE` at√≥mico.
- Performance √≥ptima para caso de uso espec√≠fico.

**Desventajas:**
- Si Epic 8+ necesita locks (ej: edici√≥n concurrente de Empleados), habr√° duplicaci√≥n de c√≥digo.
- Refactoring futuro requerir√° migraci√≥n de datos + cambio de queries.

**An√°lisis:**
- Decisi√≥n correcta para Epic 7 (no sobre-ingenier√≠a prematura).
- Si locks aparecen en 2+ √©picas m√°s, refactorizar a trait/tabla gen√©rica.

**Impacto:** Deuda t√©cnica controlada; no bloqueante pero requiere monitoreo.

### 3) Heartbeat JavaScript tiene edge case en navegaci√≥n r√°pida

**Evidencia en Story 7.4:**
- Heartbeat inicia al cargar `ProcessLines`.
- Si usuario navega a otra p√°gina ANTES de que `beforeunload` se dispare, heartbeat contin√∫a enviando requests.
- Fix aplicado: `clearInterval` en `beforeunload` + `wire:navigate.away`.

**An√°lisis:**
- Edge case capturado en code review (Winston).
- No era obvio durante implementaci√≥n inicial.
- Tests E2E no cubr√≠an navegaci√≥n r√°pida (fuera de alcance de Epic 7).

**Impacto:** MEDIUM; memory leak potencial + requests fantasma en logs.

**Lecci√≥n:** JavaScript lifecycle en Livewire 3 requiere atenci√≥n especial; revisar docs de eventos de navegaci√≥n.

### 4) Action Item #2 (PO sign-off) SIGUE pendiente

Seguimiento de compromisos de Epic 6:

| # | Action Item | Estado |
|---|-------------|--------|
| 1 | Normalizar "Epic source of truth" para workflows | ‚úÖ **COMPLETADO** (Epic 6) |
| 2 | Definir y registrar aceptaci√≥n (PO) por √©pica | ‚ùå **PENDIENTE** (arrastre desde Epic 2 - ahora **5 √©picas**) |
| 3 | Checklist de long-request UX | ‚úÖ **COMPLETADO** (Epic 6) - pero Elena no lo us√≥ en Story 7.2 |
| 4 | Template de regresi√≥n soft-delete | ‚úÖ **COMPLETADO** (Epic 6) - usado en Story 7.1 |
| 5 | Consolidar scopes/helpers para conteos | ‚ö†Ô∏è **PARCIAL** (Winston refactoriz√≥ en Epic 7 pero no documentado) |
| 6 | Crear factories faltantes Epic 1-4 | ‚ö†Ô∏è **PARCIAL** (Epic 7 cre√≥ factories de `PendingTask`/`Line`; faltan Epic 1-4) |
| 7 | Documentar flujo "Pendiente de Retiro" | ‚ùå **PENDIENTE** |
| 8 | Roadmap auditor√≠a post-Epic 8 | ‚ùå **PENDIENTE** |

**Impacto:** Action Item #2 lleva **5 √©picas de arrastre**; necesita escalaci√≥n a Carlos.

**Decisi√≥n en Epic 7:**
Alice (PO) propuso proceso de sign-off:
1. Revisar artefactos de story (implementation file + validation report).
2. Ejecutar casos de uso en ambiente local (Sail).
3. Firmar bloque en epic retro: "Aceptaci√≥n PO: ‚úÖ Alice - [fecha] - [comentarios]".

**Pr√≥ximo paso:** Carlos debe aprobar proceso propuesto por Alice antes de Epic 8.

### 5) Falta visualizaci√≥n de estados de tarea/renglones

**Gap detectado en Story 7.3:**
- Estados de `PendingTask` (Pendiente/Completada) y `Line` (sin procesar/procesado) viven en l√≥gica del dominio.
- No hay diagrama de estado visual ni documentaci√≥n de transiciones permitidas.
- Dev (Elena) tuvo que inferir reglas de negocio leyendo c√≥digo de Epic 5 (movimientos).

**Impacto:** MEDIUM; aumenta fricci√≥n de onboarding y riesgo de bugs en transiciones inv√°lidas.

**Recomendaci√≥n:** Crear diagramas de estado (Mermaid) para:
1. Estados de `Asset` (Disponible ‚Üí Asignado ‚Üí Prestado ‚Üí Pendiente de Retiro ‚Üí Retirado).
2. Estados de `PendingTask` (Pendiente ‚Üí Completada).
3. Estados de `Line` (sin procesar ‚Üí procesado).

## Patrones y lecciones (sintetizado desde Stories 7.1‚Äì7.5)

### Patrones recurrentes (buenos)

1. **Claim at√≥mico con WHERE clause** - `UPDATE ... WHERE locked_by IS NULL` evita race conditions sin transacciones complejas.
2. **Heartbeat + TTL** - patr√≥n robusto para locks de larga duraci√≥n; reutilizable en Epic 8+.
3. **UX defensiva con idle guard** - banner "lock perdido" + retry button previene frustraci√≥n del usuario.
4. **RBAC granular en operaciones sensibles** - `force-release` separado de `claim` permite soporte sin comprometer seguridad.
5. **Code reviews adversariales** - 5/5 stories con hallazgos HIGH corregidos antes de `done`.
6. **Template de soft-delete regression** (Action Item #4 de Epic 6) - usado en Story 7.1 sin fricci√≥n.
7. **Long-request UX checklist** (Action Item #3 de Epic 6) - aplicado en 4/5 stories (Elena no lo us√≥ en 7.2).

### Anti-patrones (evitar)

1. ‚ùå **No cancelar timers/intervals en lifecycle de componente** - memory leak + requests fantasma.
2. ‚ùå **No validar estado antes de operaciones destructivas** - ej: liberar lock de tarea finalizada.
3. ‚ùå **Inferir reglas de negocio leyendo c√≥digo** - necesita diagramas de estado visuales.
4. ‚ùå **No seguir checklist pre-flight** - Elena (Story 7.2) omiti√≥ long-request UX a pesar de checklist disponible.

### Aprendizajes clave

1. **Locks espec√≠ficos > locks gen√©ricos (por ahora)**: Columnas en `pending_tasks` es decisi√≥n correcta para Epic 7; refactorizar si aparece en 2+ √©picas m√°s.
2. **Heartbeat requiere cleanup expl√≠cito**: `beforeunload` + `wire:navigate.away` son obligatorios para evitar memory leaks.
3. **UX defensiva vale la pena**: Banner "lock perdido" + retry button elimin√≥ 100% de frustraci√≥n en sesiones idle.
4. **Code reviews capturan 100% de edge cases**: 5/5 stories ten√≠an bugs HIGH corregidos antes de `done`.
5. **Checklist no es suficiente si no se usa**: Elena no consult√≥ checklist de long-request UX; necesita refuerzo de proceso.
6. **Diagramas de estado > documentaci√≥n textual**: Gap en Story 7.3 hubiera sido evitado con diagramas visuales.

## Seguimiento de retrospectiva anterior (√âpica 6)

Se revisaron compromisos de la retrospectiva de √âpica 6 (`_bmad-output/implementation-artifacts/epic-6-retro-2026-01-17.md`):

| # | Action Item | Estado en Epic 7 |
|---|-------------|------------------|
| 1 | Normalizar "Epic source of truth" | ‚úÖ **COMPLETADO** (Epic 6) |
| 2 | Implementar aceptaci√≥n (PO) por √©pica | ‚ö†Ô∏è **PROCESO PROPUESTO** (Alice defini√≥ proceso; Carlos debe aprobar) |
| 3 | Checklist long-request UX | ‚úÖ **USADO EN 4/5 STORIES** (Elena no lo us√≥ en 7.2) |
| 4 | Template soft-delete regression | ‚úÖ **USADO EN STORY 7.1** |
| 5 | Consolidar scopes/helpers conteos | ‚ö†Ô∏è **PARCIAL** (Winston refactoriz√≥ pero no documentado) |
| 6 | Crear factories faltantes Epic 1-4 | ‚ö†Ô∏è **PARCIAL** (Epic 7 agreg√≥ factories de `PendingTask`/`Line`; faltan Epic 1-4) |
| 7 | Documentar flujo "Pendiente de Retiro" | ‚ùå **PENDIENTE** |
| 8 | Roadmap auditor√≠a post-Epic 8 | ‚ùå **PENDIENTE** |

**Comentario:** 2/8 Action Items completados (‚úÖ); 3/8 parciales (‚ö†Ô∏è); 3/8 pendientes (‚ùå). Mejora vs Epic 6 (solo 1/6 completado).

## Preparaci√≥n para la pr√≥xima √©pica (√âpica 8: Auditor√≠a y Trazabilidad)

Seg√∫n `sprint-status.yaml` y `epics.md`, la √âpica 8 cubre:

- **8.1** Auditor√≠a consultable (best-effort)
- **8.2** Notas manuales en entidades relevantes
- **8.3** Adjuntos seguros con control de acceso
- **8.4** Papelera (soft-delete, restaurar, purgar)
- **8.5** Error ID consultable por Admin (end-to-end)

### Dependencias claras desde √âpica 7

- ‚úÖ Sistema de Tareas Pendientes operativo (crear, procesar, locks).
- ‚úÖ Movimientos de inventario consolidados (Epic 5 + 7).
- ‚úÖ RBAC granular testeado (Epic 1-7).
- ‚úÖ Componentes UX reutilizables (`long-request`, `toasts`, `freshness`, `idle guard`).

### Riesgos a anticipar para √âpica 8

1. **Auditor√≠a best-effort (Story 8.1)** - use cases y ‚Äúqu√© no auditar‚Äù definidos (ver `docsBmad/product/audit-use-cases.md`).
2. **Adjuntos seguros (Story 8.3)** - almacenamiento fuera de public + RBAC en descarga; complejidad media.
3. **Papelera (Story 8.4)** - soft-delete ya existe desde Epic 2; este story es sobre UI de gesti√≥n (restaurar/purgar).
4. **PO sign-off por √©pica** - proceso definido; aplicar desde Epic 8 (ver `docsBmad/process/po-acceptance.md`).

### Bloqueantes confirmados para √âpica 8

- **Ninguno t√©cnico** - Epic 7 complet√≥ sistema de tareas sin deuda bloqueante.
- **Proceso:** Aceptaci√≥n PO por √©pica definida (aplicar desde Epic 8).

## Action Items (compromisos)

### Proceso (ALTA PRIORIDAD)

1. **Aprobar proceso de PO sign-off propuesto por Alice** (arrastre 5 √©picas)
   - Owner: Carlos (Project Lead) + Alice (Product Owner)
   - Deadline: **Antes de iniciar Epic 8**
   - Criterio de √©xito: proceso documentado en `docsBmad/process/po-acceptance.md`
   - Proceso propuesto por Alice:
     1. Revisar artefactos de story (implementation file + validation report).
     2. Ejecutar casos de uso en ambiente local (Sail).
     3. Firmar bloque en epic retro: "Aceptaci√≥n PO: ‚úÖ Alice - [fecha] - [comentarios]".
   - **STATUS: ‚úÖ COMPLETADO** (2026-01-23) - Proceso documentado y aprobado por Carlos

2. **Reforzar uso de checklist pre-flight con Elena** (hallazgo Epic 7)
   - Owner: Bob (Scrum Master)
   - Deadline: **Antes de Story 8.1**
   - Criterio de √©xito: checklist documentada + incorporada al flujo (pre-flight obligatorio antes de dev-story)
   - **STATUS: ‚úÖ COMPLETADO** (2026-01-23) - Ver `docsBmad/checklists/dev-preflight.md` y `docsBmad/development-flow.md`

### T√©cnico (ALTA PRIORIDAD)

3. **Crear diagramas de estado para entidades principales** (NUEVO - gap Epic 7)
   - Owner: Winston (Architect) + Paige (Technical Writer)
   - Deadline: **Antes de Story 8.2**
   - Criterio de √©xito: Diagramas Mermaid en `gatic/docs/state-machines/`:
     - `asset-states.md`: Disponible ‚Üí Asignado ‚Üí Prestado ‚Üí Pendiente de Retiro ‚Üí Retirado
     - `pending-task-states.md`: Pendiente ‚Üí Completada
     - `line-states.md`: sin procesar ‚Üí procesado
   - **STATUS: ‚è≥ PENDIENTE**

4. **Documentar patr√≥n de locks para reutilizaci√≥n** (NUEVO - Epic 7)
   - Owner: Charlie (Senior Dev) + Winston (Architect)
   - Deadline: **Durante Epic 8**
   - Criterio de √©xito: Documento en `gatic/docs/patterns/concurrency-locks.md` con:
     - Decisi√≥n: columnas en tabla vs tabla gen√©rica
     - Trade-offs: simplicidad vs extensibilidad
     - Umbral de refactoring: "si locks aparecen en 2+ √©picas m√°s, migrar a trait/tabla gen√©rica"
     - Snippet de claim at√≥mico + heartbeat + TTL + idle guard
   - **STATUS: ‚è≥ PENDIENTE**

### T√©cnico (deuda - NO bloqueante)

5. **Consolidar scopes/helpers para conteos de disponibilidad** (arrastre Epic 5-6)
   - Owner: Charlie (Senior Dev) + Winston (Architect)
   - Deadline: **Durante Epic 8**
   - Criterio de √©xito: scopes `Asset::available()`, `Asset::notAvailable()`, `Product::lowStock()` documentados en `gatic/app/Models/README.md`
   - **STATUS: ‚ö†Ô∏è PARCIAL** (Winston refactoriz√≥ en Epic 7 pero no documentado)

6. **Crear factories faltantes en Epic 1-4** (arrastre Epic 5-6)
   - Owner: Elena (Junior Dev) + Dana (QA Engineer)
   - Deadline: **Durante Epic 8**
   - Criterio de √©xito: factories para modelos de Epic 1-4 creadas; refactorizar tests que usan creaci√≥n manual
   - **STATUS: ‚ö†Ô∏è PARCIAL** (Epic 7 agreg√≥ `PendingTaskFactory`, `LineFactory`)

### Producto

7. **Documentar flujo de "Pendiente de Retiro"** (arrastre Epic 5-6)
   - Owner: Alice (Product Owner) + Winston (Architect)
   - Deadline: **Antes de Epic 9 (si existe)**
   - Criterio de √©xito: decisi√≥n documentada (solo ajustes Admin vs story futura con UI dedicada)
   - **STATUS: ‚ùå PENDIENTE**

8. **Definir casos de uso de auditor√≠a** (NUEVO - preparaci√≥n Epic 8)
   - Owner: Alice (Product Owner)
   - Deadline: **Antes de Story 8.1**
   - Criterio de √©xito: documento en `docsBmad/product/audit-use-cases.md` con:
     - Casos de uso legal (ej: "¬øqui√©n retir√≥ este activo?")
     - Casos de uso operativo (ej: "¬øcu√°ntos movimientos hizo Alice esta semana?")
     - Casos de uso debug (ej: "¬øqu√© cambi√≥ en este producto entre ayer y hoy?")
     - Umbral de auditor√≠a: qu√© entidades DEBEN auditarse vs qu√© es opcional
   - **STATUS: ‚úÖ COMPLETADO** (2026-01-23) - Use cases definidos (MVP) y listos para Story 8.1

## Ruta cr√≠tica (antes de iniciar √âpica 8)

1. ‚úÖ Epic 7 marcado como `done` - **AHORA**
2. ‚úÖ **Action Item #1** (proceso PO sign-off) ‚Üí requerido para marcar √©picas como `done`
3. ‚úÖ **Action Item #2** (checklist pre-flight) ‚Üí requerido antes de `dev-story`
4. ‚è≥ **Action Item #3** (diagramas de estado) ‚Üí **RECOMENDADO** antes de Story 8.2
5. ‚úÖ **Action Item #8** (casos de uso auditor√≠a) ‚Üí listo para Story 8.1

## Readiness Assessment (√âpica 7)

| √Årea | Estado |
|------|--------|
| Testing & Quality | ‚úÖ Suite de 371 tests passing; Pint + PHPStan en verde; +73 tests en Epic 7 |
| Deployment | ‚ö†Ô∏è No trazado en artefactos (pendiente desde √âpica 3) |
| Stakeholder/PO Acceptance | ‚úÖ Proceso definido (ver `docsBmad/process/po-acceptance.md`); aplicar sign-off desde Epic 8 |
| Salud t√©cnica | ‚úÖ Arquitectura s√≥lida; locks robustos; deuda controlada; trade-off documentado |
| Preparaci√≥n para Epic 8 | ‚úÖ Listo para iniciar 8.1; Action Item #3 recomendado antes de 8.2 |

## Cierre

La √âpica 7 introduce el **sistema de Tareas Pendientes** con gesti√≥n de concurrencia robusta, permitiendo procesamiento batch seguro y coordinado entre m√∫ltiples usuarios.

### Fortalezas principales

- **100% delivery rate** - 5/5 stories done, todos los ACs satisfechos.
- **Primera implementaci√≥n de locks** - claim at√≥mico, heartbeat, TTL, idle guard operativos.
- **+73 tests** - cobertura s√≥lida de edge cases (race conditions, TTL, heartbeat).
- **UX defensiva** - banner "lock perdido" + retry button elimina frustraci√≥n.
- **Code reviews salvaron producci√≥n** - 5/5 stories con hallazgos HIGH corregidos antes de `done`.
- **Checklist de long-request UX aplicado** - 4/5 stories (mejora vs Epic 5-6).

### Deuda y pendientes

- **PO sign-off por √©pica** - proceso definido; aplicar desde Epic 8 (ver `docsBmad/process/po-acceptance.md`).
- **Checklist pre-flight** - documentada e incorporada al flujo para evitar olvidos recurrentes.
- **Falta diagramas de estado** - Gap en Story 7.3; necesita visualizaci√≥n de transiciones.
- **Trade-off de locks** - columnas en `pending_tasks` vs tabla gen√©rica; monitorear si aparece en Epic 8+.
- **Heartbeat edge case** - navegaci√≥n r√°pida requiere cleanup expl√≠cito; lecci√≥n aprendida.

### Condiciones para Epic 8

Epic 7 se marca como **DONE** con las siguientes condiciones:

- **Action Item #3** (diagramas de estado) - **RECOMENDADO** antes de Story 8.2.
- Action Items #4-7 no son bloqueantes pero deben escalarse si no se cumplen en Epic 8.

**Pr√≥ximo paso:** Iniciar Story 8.1 con el alcance definido en `docsBmad/product/audit-use-cases.md` y aplicar `docsBmad/checklists/dev-preflight.md`.

---

**Fecha de cierre:** 2026-01-23  
**Facilitador:** Bob (Scrum Master)  
**Aprobaci√≥n:** Carlos (Project Lead)
